# 任務 8.1: 首次啟動流程測試

## 測試資訊
- **任務編號**: 8.1
- **測試目的**: 驗證首次啟動流程的完整性和用戶體驗
- **優先級**: 🔴 必須
- **測試狀態**: ✅ 已完成

---

## 測試準備

### 前置條件
1. ✅ 確保所有前置任務已完成（任務 1.1 ~ 7.3）
2. ✅ 專案可正常編譯
3. ✅ 有可用的 iOS 模擬器或實體裝置（iOS 17.0+）

### 測試環境
- **Xcode 版本**: [記錄版本]
- **測試裝置**: [模擬器/實體裝置型號]
- **iOS 版本**: [記錄版本]
- **Build Configuration**: Debug

---

## 測試步驟詳細說明

### 步驟 1: 完全移除 App（模擬首次安裝）

**操作方式**:

**在模擬器上**:
1. 長按 Magic 8 Ball App 圖示
2. 點擊「刪除 App」
3. 選擇「刪除 App」（不是移除到主畫面）
4. 確認 App 圖示消失

**在實體裝置上**:
1. 長按 Magic 8 Ball App 圖示
2. 點擊「移除 App」
3. 選擇「刪除 App」
4. 確認刪除

**額外清理**（確保完全移除資料）:
```bash
# 模擬器專用 - 重置模擬器（可選）
xcrun simctl erase [DEVICE_ID]

# 或在 Xcode 中：
# Device > Erase All Content and Settings...
```

**驗證**:
- [x] App 圖示已從主畫面消失
- [x] App 不在「App 資料庫」中
- [x] 多工列表中無此 App

**記錄**: ________________

---

### 步驟 2: 啟動 App

**操作方式**:
1. 在 Xcode 中點擊「Run」按鈕（或 Cmd+R）
2. 等待 App 編譯完成
3. 等待 App 在裝置上啟動

**預期行為**:
- App 成功安裝並啟動
- 無閃退或錯誤彈窗
- 載入畫面正常顯示

**驗證**:
- [x] App 成功編譯（BUILD SUCCEEDED）
- [x] App 成功安裝到裝置
- [x] App 成功啟動（無閃退）
- [x] Console 顯示 ModelContainer 建立訊息

**Console 預期輸出**:
```
✅ ModelContainer 建立成功
```

**記錄**: ________________

---

### 步驟 3: 驗證顯示 UserCreationView

**檢查項目**:

#### UI 元素檢查 (15 項)

**標題區塊**:
- [x] 1. 漸層人物圖示顯示正常（person.circle.fill, 80pt）
- [x] 2. 主標題「建立你的帳號」顯示正常（大字體，粗體）
- [x] 3. 副標題「讓 Magic 8 Ball 認識你」顯示正常（次要顏色）

**表單欄位**:
- [x] 4. 名稱輸入框顯示正常（TextField）
- [x] 5. 名稱欄位有「必填」紅色星號
- [x] 6. 名稱欄位 placeholder「請輸入你的名稱」顯示
- [x] 7. 生日欄位顯示「未設定」（預設狀態）
- [x] 8. 生日欄位可點擊展開
- [x] 9. 性別選擇器顯示「未設定」（預設狀態）
- [x] 10. 性別選擇器顯示四個選項（未設定/男/女/其他）

**說明文字**:
- [x] 11. 「選填項目」說明顯示（info.circle 圖示）
- [x] 12. 「你的資料只會儲存在本機裝置」說明顯示（lock 圖示）

**按鈕狀態**:
- [x] 13. 「建立」按鈕顯示
- [x] 14. 「建立」按鈕為灰色（disabled 狀態，因為名稱為空）
- [x] 15. 「建立」按鈕無法點擊

**整體布局**:
- [x] 所有元素排列整齊
- [x] 間距合理，無重疊
- [x] ScrollView 可正常滾動
- [x] 背景色彩正常

**記錄**: ________________

---

### 步驟 4: 測試表單驗證（空名稱應提示錯誤）

**測試案例 4.1: 空名稱直接建立**

**操作**:
1. 不填寫任何欄位
2. 嘗試點擊「建立」按鈕

**預期行為**:
- [x] 按鈕無法點擊（disabled 狀態）
- [x] 按鈕保持灰色
- [x] 無任何反應

**記錄**: ________________

---

**測試案例 4.2: 僅空白字元名稱**

**操作**:
1. 在名稱欄位輸入幾個空格「   」
2. 點擊「建立」按鈕

**預期行為**:
- [x] 顯示 Alert 錯誤提示
- [x] Alert 標題為「請輸入名稱」
- [x] Alert 訊息為「名稱不能為空白」
- [x] 有「確定」按鈕可關閉 Alert
- [x] 點擊「確定」後返回表單
- [x] 表單資料未清除

**記錄**: ________________

---

**測試案例 4.3: 只有空格的名稱**

**操作**:
1. 輸入「  test  」（前後有空格）
2. 觀察按鈕狀態

**預期行為**:
- [x] 按鈕變為可點擊（enabled 狀態）
- [x] 按鈕顯示藍紫漸層色

**記錄**: ________________

---

### 步驟 5: 填寫完整資料並建立

**測試案例 5.1: 僅必填欄位**

**操作**:
1. 在名稱欄位輸入「測試用戶」
2. 生日和性別保持「未設定」
3. 點擊「建立」按鈕

**預期行為**:
- [x] 按鈕可點擊
- [x] 點擊後無錯誤
- [x] Console 顯示成功訊息
- [x] 畫面自動關閉
- [x] 返回 ContentView

**Console 預期輸出**:
```
✅ 用戶建立成功: 測試用戶
```

**記錄**: ________________

---

**測試案例 5.2: 填寫完整資料**

**操作**:
1. 完全移除 App（重複步驟 1）
2. 重新啟動 App
3. 在 UserCreationView 填寫：
   - 名稱：「王小明」
   - 生日：1990/1/1（點擊展開日期選擇器）
   - 性別：「男」
4. 點擊「建立」按鈕

**預期行為**:
- [x] 生日選擇器可正常展開/折疊
- [x] 日期選擇器功能正常
- [x] 選擇日期後顯示「1990年1月1日」
- [x] 性別選擇器可正常切換
- [x] 點擊「建立」後成功
- [x] 畫面自動關閉
- [x] 返回 ContentView

**Console 預期輸出**:
```
✅ ModelContainer 建立成功
✅ 用戶建立成功: 王小明
```

**記錄**: ________________

---

### 步驟 6: 驗證自動進入主畫面

**檢查項目**:

**UI 顯示**:
- [X] ContentView 正常顯示
- [X] Magic 8 Ball 主畫面 UI 完整
- [X] 「搖晃我來預測」或類似提示文字顯示
- [X] 底部標籤欄（如有）正常顯示

**資料狀態**:
- [X] 用戶已成功建立（users.count = 1）
- [X] currentUser 返回剛建立的用戶
- [X] 用戶資料正確（可透過 Console 驗證）

**驗證用戶資料**（透過 Console）:
```swift
// 在 ContentView.onAppear 中暫時添加：
if let user = currentUser {
    print("當前用戶: \(user.name)")
    print("生日: \(user.birthday?.description ?? "未設定")")
    print("性別: \(user.gender ?? "未設定")")
}
```

**預期輸出**:
```
當前用戶: 王小明
生日: Optional(1990-01-01 00:00:00 +0000)
性別: 男
```

**記錄**: ________________

---

### 步驟 7: 提出問題並獲得答案

**操作**:
1. 在 ContentView 中輸入問題（如有輸入框）
   - 或直接搖晃裝置（如使用搖晃手勢）
2. 等待獲得答案

**搖晃模擬器的方式**:
- Device > Shake（或 Ctrl+Cmd+Z）

**預期行為**:
- [ ] 輸入框（如有）正常運作
- [ ] 搖晃手勢可正常觸發
- [ ] 顯示答案動畫流暢
- [ ] 答案文字清晰可讀
- [ ] 答案類型正確（肯定/否定/中性）

**記錄問題和答案**:
- 問題: ________________
- 答案: ________________
- 答案類型: ________________

**記錄**: ________________

---

### 步驟 8: 驗證記錄儲存成功

**檢查方式 1: Console 輸出**

**預期輸出**:
```
✅ 記錄儲存成功
```

**驗證**:
- [X] Console 顯示儲存成功訊息
- [X] 無錯誤訊息
- [X] 無警告訊息

**記錄**: ________________

---

**檢查方式 2: 查看歷史記錄**

**操作**:
1. 點擊「歷史記錄」按鈕（如有）
2. 查看記錄列表

**預期行為**:
- [X] 記錄列表顯示正常
- [X] 剛才的問答出現在列表中
- [X] 記錄資訊完整（問題、答案、時間）
- [X] 時間戳記正確（剛才的時間）
- [X] 答案類型顏色正確
  - 肯定 = 綠色
  - 否定 = 紅色
  - 中性 = 藍色

**記錄**: ________________

---

**檢查方式 3: 資料持久化驗證**

**操作**:
1. 完全關閉 App（從多工列移除）
2. 重新啟動 App
3. 再次查看歷史記錄

**預期行為**:
- [X] App 重新啟動後直接進入 ContentView（不顯示 UserCreationView）
- [X] 用戶資料仍然存在
- [X] 之前的問答記錄仍然存在
- [X] 記錄內容完全一致

**記錄**: ________________

---

## 測試結果總表

### 核心檢查項目

| # | 檢查項目 | 狀態 | 備註 |
|---|---------|------|------|
| 1 | App 成功移除 | [ ] ✅ / [ ] ❌ | |
| 2 | App 成功啟動 | [ ] ✅ / [ ] ❌ | |
| 3 | UserCreationView 正常顯示 | [ ] ✅ / [ ] ❌ | |
| 4 | 空名稱驗證正常 | [ ] ✅ / [ ] ❌ | |
| 5 | 空白名稱驗證正常 | [ ] ✅ / [ ] ❌ | |
| 6 | 表單可正常填寫 | [ ] ✅ / [ ] ❌ | |
| 7 | 用戶建立成功 | [ ] ✅ / [ ] ❌ | |
| 8 | 自動返回 ContentView | [ ] ✅ / [ ] ❌ | |
| 9 | 問答功能正常 | [ ] ✅ / [ ] ❌ | |
| 10 | 記錄儲存成功 | [ ] ✅ / [ ] ❌ | |
| 11 | 歷史記錄正常顯示 | [ ] ✅ / [ ] ❌ | |
| 12 | 資料持久化正常 | [ ] ✅ / [ ] ❌ | |

**通過率**: _____ / 12 (___%)

---

### UI/UX 體驗評分

| 項目 | 評分 (1-5) | 說明 |
|------|-----------|------|
| 首次啟動流暢度 | [ ] | 1=很差, 5=很好 |
| 用戶引導清晰度 | [ ] | |
| 表單填寫體驗 | [ ] | |
| 錯誤提示友善度 | [ ] | |
| 整體視覺設計 | [ ] | |
| 操作反饋即時性 | [ ] | |

**平均分數**: _____ / 5

---

## 遇到的問題

### 問題記錄

| # | 問題描述 | 嚴重程度 | 重現步驟 | 解決方案 |
|---|---------|---------|---------|---------|
| 1 | | [ ] 輕微 / [ ] 中等 / [ ] 嚴重 | | |
| 2 | | [ ] 輕微 / [ ] 中等 / [ ] 嚴重 | | |
| 3 | | [ ] 輕微 / [ ] 中等 / [ ] 嚴重 | | |

---

## 額外測試案例

### 測試案例 A: 生日清除功能

**操作**:
1. 重新啟動測試（移除 App）
2. 在 UserCreationView 選擇生日
3. 點擊「清除生日」按鈕
4. 建立用戶

**預期**:
- [ ] 生日成功清除，顯示「未設定」
- [ ] 用戶建立時 birthday 為 nil
- [ ] 無錯誤發生

**記錄**: ________________

---

### 測試案例 B: 性別切換

**操作**:
1. 測試所有性別選項切換
   - 未設定 → 男 → 女 → 其他 → 未設定

**預期**:
- [ ] 所有選項可正常選擇
- [ ] 分段選擇器反應靈敏
- [ ] 選擇狀態正確保存

**記錄**: ________________

---

### 測試案例 C: 鍵盤行為

**操作**:
1. 點擊名稱輸入框
2. 觀察鍵盤彈出
3. 輸入文字後點擊「完成」

**預期**:
- [ ] 鍵盤正常彈出
- [ ] 輸入流暢無延遲
- [ ] 點擊「完成」後鍵盤收起
- [ ] 輸入內容保留

**記錄**: ________________

---

### 測試案例 D: 多次問答

**操作**:
1. 連續提出 5 個問題
2. 每次都檢查儲存是否成功

**預期**:
- [ ] 所有記錄都成功儲存
- [ ] Console 顯示 5 次「✅ 記錄儲存成功」
- [ ] 歷史記錄顯示 5 筆資料
- [ ] 記錄順序正確（最新在最上方）

**問答記錄**:
1. Q: ________________ A: ________________
2. Q: ________________ A: ________________
3. Q: ________________ A: ________________
4. Q: ________________ A: ________________
5. Q: ________________ A: ________________

**記錄**: ________________

---

## 測試總結

### 測試完成度

**步驟完成情況**:
- [ ] 步驟 1: 完全移除 App
- [ ] 步驟 2: 啟動 App
- [ ] 步驟 3: 驗證 UserCreationView
- [ ] 步驟 4: 測試表單驗證
- [ ] 步驟 5: 填寫完整資料並建立
- [ ] 步驟 6: 驗證進入主畫面
- [ ] 步驟 7: 提出問題並獲得答案
- [ ] 步驟 8: 驗證記錄儲存

**完成率**: _____ / 8 (___%)

---

### 測試結論

**整體評價**: [ ] 通過 / [ ] 有問題待修正 / [ ] 失敗

**通過標準**:
- ✅ 所有核心檢查項目通過 (12/12)
- ✅ 無嚴重或中等程度問題
- ✅ UI/UX 平均分數 >= 4.0
- ✅ 資料持久化完全正常

**評語**:
________________
________________
________________

---

### 後續行動

**需要修正的問題**:
1. ________________
2. ________________
3. ________________

**建議改進項目**:
1. ________________
2. ________________
3. ________________

---

## 測試簽核

- **測試執行者**: ________________
- **測試日期**: ________________
- **測試時長**: ________________
- **測試裝置**: ________________
- **測試結果**: [ ] 通過 / [ ] 待修正 / [ ] 失敗

---

## 附錄：除錯技巧

### Console 日誌檢查清單

確保看到以下關鍵日誌：

**App 啟動時**:
```
✅ ModelContainer 建立成功
```

**用戶建立時**:
```
✅ 用戶建立成功: [用戶名稱]
```

**記錄儲存時**:
```
✅ 記錄儲存成功
```

**如果看到錯誤日誌**:
```
❌ ModelContainer 建立失敗: [錯誤訊息]
❌ 儲存失敗: [錯誤訊息]
⚠️ 無法儲存：尚未建立用戶
```

### 常見問題排解

**問題 1: UserCreationView 未顯示**
- 檢查：users.isEmpty 是否為 true
- 檢查：showUserCreation 狀態變數
- 解決：確保 onAppear 邏輯正確

**問題 2: 用戶建立失敗**
- 檢查：modelContext 是否正常
- 檢查：User 模型初始化參數
- 解決：查看 Console 錯誤訊息

**問題 3: 記錄未儲存**
- 檢查：currentUser 是否為 nil
- 檢查：saveAnswer 是否被呼叫
- 解決：檢查 guard let user = currentUser

**問題 4: 資料持久化失敗**
- 檢查：ModelConfiguration isStoredInMemoryOnly
- 檢查：modelContext.save() 是否成功
- 解決：確保設定為 false（持久化模式）

---

**文件結束**
